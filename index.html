<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP 專屬抽獎池</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --accent-a: #ff2d55;
            --accent-b: #007aff;
            --gold: #ffb100;
        }

        body {
            background: radial-gradient(circle at 50% 0%, #1a1a2e 0%, #050505 100%);
            color: #fff;
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center; padding: 20px;
        }

        /* 標題特效：極致顯眼 */
        .title-hero {
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: linear-gradient(to bottom, #ffffff 30%, #cccccc 60%, #888888 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            /* 加入微光外溢效果 */
            filter: drop-shadow(0 0 15px rgba(255,255,255,0.2));
            line-height: 1.2;
        }

        /* 語系切換 */
        .lang-control { position: fixed; top: 1.5rem; right: 1.5rem; z-index: 9999; display: flex; gap: 0.5rem; }
        .lang-btn { background: var(--glass); border: 1px solid var(--glass-border); backdrop-filter: blur(10px); padding: 6px 12px; font-size: 11px; color: rgba(255,255,255,0.4); border-radius: 6px; cursor: pointer; transition: 0.3s; }
        .lang-btn.active { color: #fff; border-color: rgba(255,255,255,0.5); background: rgba(255,255,255,0.15); }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            border-radius: 40px;
            width: 100%; max-width: 650px; padding: 40px;
            box-shadow: 0 40px 100px rgba(0,0,0,0.8);
            position: relative;
        }

        /* 皇冠動畫 */
        .crown-icon {
            position: absolute;
            top: -45px; left: 50%;
            transform: translateX(-50%);
            width: 55px; height: 55px;
            filter: drop-shadow(0 0 15px var(--gold));
            z-index: 20;
            display: none;
            animation: crownBounce 2.5s infinite ease-in-out;
        }
        @keyframes crownBounce { 0%, 100% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(-12px); } }

        /* 按鈕視覺 */
        .btn-premium { border-radius: 20px; font-weight: 900; font-size: 13px; letter-spacing: 2px; text-transform: uppercase; transition: 0.4s; border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        .btn-a { background: linear-gradient(145deg, rgba(255, 45, 85, 0.2), rgba(128, 0, 26, 0.6)); color: #ffbaba; }
        .btn-a:hover { background: rgba(255, 45, 85, 0.6); color: #fff; box-shadow: 0 0 20px rgba(255, 45, 85, 0.4); transform: translateY(-3px); }
        .btn-b { background: linear-gradient(145deg, rgba(0, 122, 255, 0.2), rgba(0, 51, 102, 0.6)); color: #bad9ff; }
        .btn-b:hover { background: rgba(0, 122, 255, 0.6); color: #fff; box-shadow: 0 0 20px rgba(0, 122, 255, 0.4); transform: translateY(-3px); }

        /* 進度條 */
        .progress-container { height: 64px; background: rgba(0,0,0,0.8); border-radius: 22px; position: relative; overflow: hidden; border: 1px solid var(--glass-border); display: flex; }
        .bar-a { background: linear-gradient(90deg, #80001a, var(--accent-a)); transition: width 1.2s cubic-bezier(0.23, 1, 0.32, 1); display: flex; align-items: center; justify-content: center; }
        .bar-b { background: linear-gradient(90deg, var(--accent-b), #003366); transition: width 1.2s cubic-bezier(0.23, 1, 0.32, 1); display: flex; align-items: center; justify-content: center; }
        .percent-text { font-weight: 900; font-size: 1.5rem; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .vs-label { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); background: #fff; color: #000; font-weight: 900; padding: 2px 12px; border-radius: 6px; font-size: 12px; z-index: 10; }

        /* 限定成就區 */
        .ultimate-reward-card { position: relative; background: rgba(255, 177, 0, 0.03); border-radius: 32px; padding: 3px; overflow: hidden; margin-top: 40px; }
        .ultimate-reward-card::before { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(transparent, transparent, transparent, var(--gold)); animation: rotate 4s linear infinite; }
        .ultimate-inner { position: relative; z-index: 1; background: #0a0a0a; border-radius: 30px; padding: 24px; display: flex; align-items: center; gap: 24px; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .gold-text-metallic { background: linear-gradient(135deg, #bf953f 0%, #fcf6ba 45%, #b38728 50%, #fcf6ba 55%, #aa771c 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900; }
    </style>
</head>
<body>

    <div class="lang-control">
        <button class="lang-btn" onclick="changeLang('zh-TW')" id="btn-zh-TW">繁</button>
        <button class="lang-btn" onclick="changeLang('zh-CN')" id="btn-zh-CN">简</button>
        <button class="lang-btn" onclick="changeLang('en')" id="btn-en">EN</button>
        <button class="lang-btn" onclick="changeLang('ja')" id="btn-ja">JP</button>
    </div>

    <div class="glass-card">
        <!-- 皇冠 SVG -->
        <svg id="crown" class="crown-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 21H19V19H5V21ZM5 17H19V11L15 13L12 7L9 13L5 11V17ZM12 5C13.1046 5 14 4.10457 14 3C14 1.89543 13.1046 1 12 1C10.8954 1 10 1.89543 10 3C10 4.10457 10.8954 5 12 5Z" fill="#ffb100"/>
        </svg>

        <header class="text-center mb-10">
            <!-- 強化版標題 -->
            <h1 id="i18n-main-title" class="title-hero text-5xl md:text-6xl mb-10">VIP 專屬抽獎池</h1>
            
            <div class="text-left border border-white/10 p-5 rounded-2xl bg-white/5">
                <h3 id="i18n-rule-header" class="text-[10px] font-bold text-orange-400 tracking-[0.3em] uppercase mb-3">Event Rules / 活動規則</h3>
                <ul id="i18n-rules-list" class="text-[11px] text-gray-400 space-y-2 font-light leading-relaxed"></ul>
            </div>
        </header>

        <div class="grid grid-cols-2 gap-8 mb-12">
            <div id="container-a" class="relative text-center">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Nintendo_Switch_Console.png/640px-Nintendo_Switch_Console.png" class="h-28 mx-auto mb-6 object-contain" alt="Switch">
                <button id="i18n-btn-a" onclick="castVote('A')" class="btn-premium btn-a w-full py-4 uppercase">選擇 Switch</button>
            </div>
            <div id="container-b" class="relative text-center">
                <img src="https://www.freeiconspng.com/uploads/diamond-png-21.png" class="h-28 mx-auto mb-6 object-contain" alt="Diamond">
                <button id="i18n-btn-b" onclick="castVote('B')" class="btn-premium btn-b w-full py-4 uppercase">選擇 鑽石</button>
            </div>
        </div>

        <div class="progress-container mb-3">
            <div id="bar-a" class="bar-a" style="width: 50%"><span id="percent-a" class="percent-text">50%</span></div>
            <div id="bar-b" class="bar-b" style="width: 50%"><span id="percent-b" class="percent-text">50%</span></div>
            <div class="vs-label">VS</div>
        </div>
        
        <div class="flex justify-between px-3 mb-10 text-[10px] font-black text-gray-500 tracking-widest uppercase">
            <span id="count-a">0 人已投票</span>
            <span id="count-b">0 人已投票</span>
        </div>

        <div class="ultimate-reward-card">
            <div class="ultimate-inner">
                <div class="iphone-halo">
                    <img src="https://img.icons8.com/fluency/240/iphone-14-pro.png" class="w-20 z-10" alt="iPhone">
                </div>
                <div>
                    <div class="inline-block px-2 py-1 bg-orange-500/10 rounded border border-orange-500/30 mb-2">
                        <span id="i18n-tag" class="text-[10px] text-orange-400 font-black tracking-[0.2em] uppercase">限定成就加碼</span>
                    </div>
                    <h4 id="i18n-grand-title" class="gold-text-metallic text-lg mb-2 leading-tight">50% vs 50% 則抽出 iPhone 17 Pro</h4>
                    <p id="i18n-grand-desc" class="text-[10px] text-gray-400 leading-relaxed font-light"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const i18n = {
            'zh-TW': {
                mainTitle: 'VIP 專屬抽獎池',
                btnA: 'Switch', btnB: '鑽石',
                confirmMsg: '一經選擇則無法更改！你確定要投給',
                votedSuffix: '人已投票', tag: '限定成就加碼',
                rules: [
                    '1. 選擇參與獎池，若選擇的獎項為多數則抽取投票該獎項用戶',
                    '2. 活動期間不可任意更改選擇',
                    '3. 結束後統計最終比例',
                    '4. 投票比例不相同，則僅抽出比例最高獎池之投票名單',
                    '5. 若最終比例為50% vs 50% 則從全體用戶抽出 iPhone 17 Pro，原獎項不抽'
                ],
                grandTitle: '50% vs 50% 則抽出 iPhone 17 Pro',
                grandDesc: '若最終比例為完美平衡，將從全體用戶抽出 iPhone 17 Pro，原獎項不抽。'
            },
            'zh-CN': {
                mainTitle: 'VIP 专属抽奖池',
                btnA: 'Switch', btnB: '钻石',
                confirmMsg: '一经选择则无法更改！你确定要投给',
                votedSuffix: '人已投票', tag: '限定成就加码',
                rules: [
                    '1. 选择参与奖池，若选择的奖项为多数则抽取投票该奖项用户',
                    '2. 活动期间不可任意更改选择',
                    '3. 结束后统计最终比例',
                    '4. 投票比例不相同，则仅抽出比例最高奖池之投票名单',
                    '5. 若最终比例为50% vs 50% 则從全体用户抽出 iPhone 17 Pro，原奖项不抽'
                ],
                grandTitle: '50% vs 50% 则抽出 iPhone 17 Pro',
                grandDesc: '若最终比例为完美平衡，将從全体用户抽出 iPhone 17 Pro，原奖项不抽。'
            },
            'en': {
                mainTitle: 'VIP EXCLUSIVE POOL',
                btnA: 'Switch', btnB: 'Diamond',
                confirmMsg: 'Final choice! Vote for',
                votedSuffix: 'People Voted', tag: 'LIMITED ACHIEVEMENT',
                rules: [
                    '1. Choose a pool; if majority wins, participants in that pool enter draw.',
                    '2. Selection cannot be changed.',
                    '3. Final stats calculated after event.',
                    '4. Majority pool wins the draw.',
                    '5. If 50/50, iPhone 17 Pro for ALL (original prizes void).'
                ],
                grandTitle: '50% vs 50% Unlocks iPhone 17 Pro',
                grandDesc: 'If final ratios are balanced, iPhone 17 Pro will be drawn from all users.'
            },
            'ja': {
                mainTitle: 'VIP 専用抽選プール',
                btnA: 'Switch', btnB: 'ダイヤモンド',
                confirmMsg: '変更できません！本当に',
                votedSuffix: '人が投票済み', tag: '限定アチーブメント',
                rules: [
                    '1. プールを選択。多数派のプールからのみ抽選が行われます。',
                    '2. 選択後の変更は不可。',
                    '3. 終了後に集計。',
                    '4. 比率が高いプールからのみ抽選。',
                    '5. 50/50 の場合、全ユーザーから iPhone 17 Pro を抽選。'
                ],
                grandTitle: '50% vs 50% で iPhone 17 Pro 抽選',
                grandDesc: '最終比率が一致した場合、全員の中から iPhone 17 Pro を抽選します。'
            }
        };

        let currentLang = 'zh-TW';

        function changeLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${lang}`).classList.add('active');
            const d = i18n[lang];
            document.getElementById('i18n-main-title').innerText = d.mainTitle;
            document.getElementById('i18n-btn-a').innerText = '選擇 ' + d.btnA;
            document.getElementById('i18n-btn-b').innerText = '選擇 ' + d.btnB;
            document.getElementById('i18n-tag').innerText = d.tag;
            document.getElementById('i18n-grand-title').innerText = d.grandTitle;
            document.getElementById('i18n-grand-desc').innerText = d.grandDesc;
            const list = document.getElementById('i18n-rules-list');
            list.innerHTML = d.rules.map(r => `<li>${r}</li>`).join('');
            updateUI();
        }

        async function updateUI() {
            try {
                const res = await fetch('/api/votes');
                const data = await res.json();
                document.getElementById('bar-a').style.width = data.A.percent + '%';
                document.getElementById('bar-b').style.width = data.B.percent + '%';
                document.getElementById('percent-a').innerText = data.A.percent + '%';
                document.getElementById('percent-b').innerText = data.B.percent + '%';
                
                const suffix = i18n[currentLang].votedSuffix;
                document.getElementById('count-a').innerText = `${data.A.count.toLocaleString()} ${suffix}`;
                document.getElementById('count-b').innerText = `${data.B.count.toLocaleString()} ${suffix}`;

                const crown = document.getElementById('crown');
                if (data.A.count === data.B.count) {
                    crown.style.display = 'none';
                } else {
                    crown.style.display = 'block';
                    const targetId = data.A.count > data.B.count ? 'container-a' : 'container-b';
                    document.getElementById(targetId).appendChild(crown);
                }
            } catch (e) {}
        }

        async function castVote(choice) {
            if (localStorage.getItem('voted_vip_v5')) {
                alert(currentLang === 'en' ? 'Voted!' : '已投票！');
                return;
            }
            const name = (choice === 'A') ? i18n[currentLang].btnA : i18n[currentLang].btnB;
            if (window.confirm(`${i18n[currentLang].confirmMsg} 【${name}】 嗎？`)) {
                await fetch('/api/vote', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({choice})
                });
                localStorage.setItem('voted_vip_v5', 'true');
                updateUI();
            }
        }

        const navLang = navigator.language.includes('ja') ? 'ja' : navigator.language.includes('zh-CN') ? 'zh-CN' : navigator.language.includes('zh') ? 'zh-TW' : 'en';
        changeLang(navLang);
        setInterval(updateUI, 5000);
    </script>
</body>
</html>
