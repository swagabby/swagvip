<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP 專屬抽獎池</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --accent-a: #ff3b30;
            --accent-b: #007aff;
            --gold: #ffb100;
        }

        body {
            background: radial-gradient(circle at 50% 0%, #1a1a2e 0%, #050505 100%);
            color: #fff;
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* 語系控制 */
        .lang-control { position: fixed; top: 1.5rem; right: 1.5rem; z-index: 9999; display: flex; gap: 0.5rem; }
        .lang-btn { background: var(--glass); border: 1px solid var(--glass-border); padding: 6px 12px; font-size: 11px; color: rgba(255,255,255,0.4); border-radius: 6px; cursor: pointer; transition: 0.3s; }
        .lang-btn.active { color: #fff; border-color: #fff; background: rgba(255,255,255,0.1); }

        /* 主卡片 */
        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            border-radius: 40px;
            width: 100%;
            max-width: 650px;
            padding: 40px;
            box-shadow: 0 40px 100px rgba(0,0,0,0.8);
        }

        /* 進度條內部 % 數 */
        .progress-container { height: 60px; background: #000; border-radius: 20px; position: relative; overflow: hidden; border: 1px solid var(--glass-border); display: flex; }
        .bar-a { background: linear-gradient(90deg, #80001a, var(--accent-a)); transition: width 1.2s cubic-bezier(0.23, 1, 0.32, 1); display: flex; align-items: center; justify-content: center; }
        .bar-b { background: linear-gradient(90deg, var(--accent-b), #003366); transition: width 1.2s cubic-bezier(0.23, 1, 0.32, 1); display: flex; align-items: center; justify-content: center; }
        .percent-text { font-weight: 900; font-size: 1.4rem; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .vs-label { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); background: #fff; color: #000; font-weight: 900; font-style: italic; padding: 2px 10px; border-radius: 4px; font-size: 12px; z-index: 10; }

        /* 終極大獎：流光外框 */
        .ultimate-reward-card {
            position: relative;
            background: rgba(255, 177, 0, 0.03);
            border-radius: 30px;
            padding: 3px; /* 這裡作為邊框寬度 */
            overflow: hidden;
            margin-top: 40px;
        }

        .ultimate-reward-card::before {
            content: "";
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: conic-gradient(transparent, transparent, transparent, var(--gold));
            animation: rotate 4s linear infinite;
        }
        
        .ultimate-inner {
            position: relative;
            z-index: 1;
            background: #0a0a0a;
            border-radius: 27px;
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 24px;
        }

        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* iPhone 浮動 */
        .iphone-halo { position: relative; flex-shrink: 0; display: flex; justify-content: center; }
        .iphone-halo::after { content: ""; position: absolute; width: 100px; height: 100px; background: radial-gradient(circle, rgba(255,177,0,0.3) 0%, transparent 70%); animation: pulse 2s infinite alternate; }
        .iphone-img { width: 90px; z-index: 2; animation: float 3s ease-in-out infinite; }
        
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse { from { transform: scale(0.8); opacity: 0.4; } to { transform: scale(1.2); opacity: 0.7; } }

        .gold-text-metallic {
            background: linear-gradient(135deg, #bf953f 0%, #fcf6ba 45%, #b38728 50%, #fcf6ba 55%, #aa771c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
        }
    </style>
</head>
<body>

    <div class="lang-control">
        <button class="lang-btn" onclick="changeLang('zh-TW')" id="btn-zh-TW">繁</button>
        <button class="lang-btn" onclick="changeLang('zh-CN')" id="btn-zh-CN">简</button>
        <button class="lang-btn" onclick="changeLang('en')" id="btn-en">EN</button>
        <button class="lang-btn" onclick="changeLang('ja')" id="btn-ja">JP</button>
    </div>

    <div class="glass-card">
        <header class="text-center mb-10">
            <h1 id="i18n-main-title" class="text-4xl md:text-5xl font-black bg-clip-text text-transparent bg-gradient-to-b from-white to-gray-500 mb-6 uppercase tracking-tight">VIP 專屬抽獎池</h1>
            <div class="rule-box text-left border border-white/10 p-5 rounded-2xl bg-white/5">
                <h3 id="i18n-rule-header" class="text-[10px] font-bold text-orange-400 tracking-[0.3em] uppercase mb-3">Event Rules / 活動規則</h3>
                <ul id="i18n-rules-list" class="text-xs text-gray-400 space-y-2 font-light leading-relaxed">
                    <!-- 動態載入規則 -->
                </ul>
            </div>
        </header>

        <!-- 獎項選擇 -->
        <div class="grid grid-cols-2 gap-6 mb-10">
            <div class="text-center">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Nintendo_Switch_Console.png/640px-Nintendo_Switch_Console.png" class="h-28 mx-auto mb-4 object-contain" alt="Switch">
                <button id="i18n-btn-a" onclick="castVote('A')" class="w-full py-4 bg-[#ff3b30] hover:scale-105 active:scale-95 rounded-2xl font-black text-xs transition-all shadow-lg shadow-red-900/20">選擇 Switch</button>
            </div>
            <div class="text-center">
                <img src="https://www.freeiconspng.com/uploads/diamond-png-21.png" class="h-28 mx-auto mb-4 object-contain" alt="Diamond">
                <button id="i18n-btn-b" onclick="castVote('B')" class="w-full py-4 bg-[#007aff] hover:scale-105 active:scale-95 rounded-2xl font-black text-xs transition-all shadow-lg shadow-blue-900/20">選擇 鑽石</button>
            </div>
        </div>

        <!-- 互動 Bar -->
        <div class="progress-container mb-3">
            <div id="bar-a" class="bar-a" style="width: 50%"><span id="percent-a" class="percent-text">50%</span></div>
            <div id="bar-b" class="bar-b" style="width: 50%"><span id="percent-b" class="percent-text">50%</span></div>
            <div class="vs-label">VS</div>
        </div>
        
        <!-- 人數顯示 -->
        <div class="flex justify-between px-2 mb-10 text-[11px] font-bold text-gray-500 tracking-wider uppercase">
            <span id="count-a">0 People</span>
            <span id="count-b">0 People</span>
        </div>

        <!-- 加碼獎勵區 -->
        <div class="ultimate-reward-card">
            <div class="ultimate-inner">
                <div class="iphone-halo">
                    <img src="https://img.icons8.com/fluency/240/iphone-14-pro.png" class="iphone-img" alt="iPhone">
                </div>
                <div>
                    <div class="inline-block px-2 py-1 bg-orange-500/20 rounded border border-orange-500/30 mb-2">
                        <span id="i18n-tag" class="text-[10px] text-orange-400 font-black tracking-widest uppercase">限定成就加碼</span>
                    </div>
                    <h4 id="i18n-grand-title" class="gold-text-metallic text-xl mb-2 leading-tight">50% vs 50% 則抽出 iPhone 17 Pro</h4>
                    <p id="i18n-grand-desc" class="text-[11px] text-gray-400 leading-relaxed">
                        若最終比例達成完美平衡，將從全體用戶抽出 iPhone 17 Pro，原獎項不抽。
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const i18n = {
            'zh-TW': {
                mainTitle: 'VIP 專屬抽獎池',
                btnA: 'Switch', btnB: '鑽石',
                confirmMsg: '一經選擇則無法更改！你確定要投給',
                unit: '人',
                tag: '限定成就加碼',
                rules: [
                    '1. 選擇參與獎池',
                    '2. 活動期間不可更改選擇',
                    '3. 結束後統計最終比例',
                    '4. 投票比例不相同，則僅抽出比例最高獎池之投票名單',
                    '5. 若最終比例為50% vs 50% 則從全體用戶抽出 iPhone 17 Pro，原獎項不抽'
                ],
                grandTitle: '50% vs 50% 則抽出 iPhone 17 Pro',
                grandDesc: '若最終比例為完美平衡，將從全體用戶抽出 iPhone 17 Pro，原獎項不抽。'
            },
            'zh-CN': {
                mainTitle: 'VIP 专属抽奖池',
                btnA: 'Switch', btnB: '钻石',
                confirmMsg: '一经选择则无法更改！你确定要投给',
                unit: '人',
                tag: '限定成就加码',
                rules: [
                    '1. 选择参与奖池',
                    '2. 活动期间不可更改选择',
                    '3. 结束后统计最终比例',
                    '4. 投票比例不相同，则仅抽出比例最高奖池之投票名单',
                    '5. 若最终比例为50% vs 50% 则從全体用户抽出 iPhone 17 Pro，原奖项不抽'
                ],
                grandTitle: '50% vs 50% 则抽出 iPhone 17 Pro',
                grandDesc: '若最终比例为完美平衡，将從全体用户抽出 iPhone 17 Pro，原奖项不抽。'
            },
            'en': {
                mainTitle: 'VIP EXCLUSIVE POOL',
                btnA: 'Switch', btnB: 'Diamond',
                confirmMsg: 'Final choice! Vote for',
                unit: 'Votes',
                tag: 'LIMITED ACHIEVEMENT',
                rules: [
                    '1. Select your desired prize pool.',
                    '2. Choice cannot be changed.',
                    '3. Final stats counted after event.',
                    '4. If ratios differ, only the majority pool is drawn.',
                    '5. If 50/50, iPhone 17 Pro is drawn from ALL users (original prizes void).'
                ],
                grandTitle: '50% vs 50% Unlocks iPhone 17 Pro',
                grandDesc: 'If final ratios are perfectly balanced, iPhone 17 Pro will be drawn from all users.'
            },
            'ja': {
                mainTitle: 'VIP 専用抽選プール',
                btnA: 'Switch', btnB: 'ダイヤモンド',
                confirmMsg: '変更できません！本当に',
                unit: '人',
                tag: '限定アチーブメント',
                rules: [
                    '1. 参加したいプールを選択。',
                    '2. 選択後の変更は不可。',
                    '3. 終了後に最終比率を集計。',
                    '4. 比率が異なる場合、多数派のみが抽選対象。',
                    '5. 50/50 の場合、全ユーザーから iPhone 17 Pro を抽選（元の賞品は無効）。'
                ],
                grandTitle: '50% vs 50% で iPhone 17 Pro 抽選',
                grandDesc: '最終比率が完全に一致した場合、全ユーザーの中から iPhone 17 Pro を抽選します。'
            }
        };

        let currentLang = 'zh-TW';

        function changeLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${lang}`).classList.add('active');
            
            const d = i18n[lang];
            document.getElementById('i18n-main-title').innerText = d.mainTitle;
            document.getElementById('i18n-btn-a').innerText = '選擇 ' + d.btnA;
            document.getElementById('i18n-btn-b').innerText = '選擇 ' + d.btnB;
            document.getElementById('i18n-tag').innerText = d.tag;
            document.getElementById('i18n-grand-title').innerText = d.grandTitle;
            document.getElementById('i18n-grand-desc').innerText = d.grandDesc;
            
            const list = document.getElementById('i18n-rules-list');
            list.innerHTML = d.rules.map(r => `<li>${r}</li>`).join('');
            updateUI(); // 刷新人數單位
        }

        async function updateUI() {
            try {
                const res = await fetch('/api/votes');
                const data = await res.json();
                document.getElementById('bar-a').style.width = data.A.percent + '%';
                document.getElementById('bar-b').style.width = data.B.percent + '%';
                document.getElementById('percent-a').innerText = data.A.percent + '%';
                document.getElementById('percent-b').innerText = data.B.percent + '%';
                
                // 更新人數
                const unit = i18n[currentLang].unit;
                document.getElementById('count-a').innerText = `${data.A.count.toLocaleString()} ${unit}`;
                document.getElementById('count-b').innerText = `${data.B.count.toLocaleString()} ${unit}`;
            } catch (e) {}
        }

        async function castVote(choice) {
            if (localStorage.getItem('voted_vip_2025_v2')) {
                alert(currentLang === 'en' ? 'Voted!' : '已投票！');
                return;
            }
            const name = (choice === 'A') ? i18n[currentLang].btnA : i18n[currentLang].btnB;
            if (window.confirm(`${i18n[currentLang].confirmMsg} 【${name}】 嗎？`)) {
                await fetch('/api/vote', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({choice})
                });
                localStorage.setItem('voted_vip_2025_v2', 'true');
                updateUI();
                alert(currentLang === 'en' ? 'Success!' : '投票成功！');
            }
        }

        const navLang = navigator.language.includes('ja') ? 'ja' : navigator.language.includes('zh-CN') ? 'zh-CN' : navigator.language.includes('zh') ? 'zh-TW' : 'en';
        changeLang(navLang);
        setInterval(updateUI, 5000);
    </script>
</body>
</html>
